<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style></style>
</head>
<body>
    <div class="tooltip"></div>
<svg>
    <defs>
        <linearGradient id="oceanGradient" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="10%" style="stop-color:rgb(0,0,27);stop-opacity:1" />
          <stop offset="70%" style="stop-color:rgb(51,122,183);stop-opacity:1" />
        </linearGradient>
      </defs>
</svg>
<script src="https://d3js.org/d3.v7.min.js"></script>

<script>

let width = 1000, height = 600;
let svg = d3.select("svg")
    .attr("viewBox", "0 0 " + width + " " + height)


// Load external data
Promise.all([d3.json('sgmap.json'), d3.csv('population2021.csv')]).then(data => {


// console.log(data[0]);
// console.log(data[1]);


// Map and projection
var projection = d3.geoMercator()
    .center([103.851959, 1.290270])
    .fitExtent([[20, 20], [980, 580]], data[0]);

let geopath = d3.geoPath().projection(projection);

var colorScale = d3.scaleThreshold()
  .domain([100000, 1000000, 10000000, 30000000, 100000000, 500000000])
  .range(d3.schemeBlues[7]);

svg.append("path")
    .datum({type: "Sphere"})
    .attr("id", "ocean")
    .attr("d", geopath)
    .attr("fill", "url(#oceanGradient)");

svg.append("g")
    .attr("id", "districts")
    .selectAll("path")
    .data(data[0].features)
    .enter()
    .append("path")
    .attr("d", geopath)
    .attr("stroke", "white")
    .attr("stroke-width", 0.1)
    .attr("fill", "black")
 


    .on("mouseover", (event, d) => {
        
    d3.select(".tooltip")
    .text(
        "Name: [" + d.properties.Name.toLowerCase() +"]"
        + " "
        + "Population: " 
        + (getPopulation(d.properties['Planning Area Name']))
        )    
    .style("position", "absolute")
    .style("background", "#fff")
    .style("left", (event.pageX) + "px")
    .style("top", (event.pageY) + "px")
    

    d3.select(event.currentTarget)
    .transition()
    .duration(300)
    .attr("stroke", "yellow")
    .attr("fill", "orange")

    function getPopulation(x){
            for (i=0; i<data[1].length; i++){
                if((data[1][i]['Planning Area'].toUpperCase()) == x){
                    return data[1][i].Population
                }
                
            }
        }
    
    function getSubzone(x){
        for (i=0; i<data[1].length; i++){
            if((data[1][i]['Planning Area'].toUpperCase()) == x){
                return data[1][i].Subzone
            }
            
        }
    }


    })
    .on("mouseout", (event, d) => {
    d3.select(".tooltip")
    .text("");

    d3.select(event.currentTarget)
    .transition()
    .duration(300)
    .attr("stroke", "white")
    .attr("stroke-width", 0.1)
    .attr("fill", "black")
    })



})


</script>

</body>
</html>